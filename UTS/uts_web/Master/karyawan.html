<div class="h1 text-center">Karyawan</div>

<button
  type="button"
  class="btn btn-add btn-danger px-3 my-2"
  data-toggle="modal"
  data-target="#staticBackdrop"
>
  <i class="bi bi-plus-lg"></i>
</button>

<table
  id="myTable"
  class="table text-center table-hover table-striped mb-0 bg-white"
>
  <thead class="bg-light">
    <tr>
      <th>Kode</th>
      <th>Nama</th>
      <th>Jabatan</th>
      <th>Telepon</th>
      <th>Email</th>
      <th>Password</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>K001</td>
      <td>Ali</td>
      <td>Admin</td>
      <td>098765432</td>
      <td>agus@gmail.com</td>
      <td>1234</td>
      <td>
        <button
          type="button"
          data-target="#staticBackdrop"
          class="updateBarang btn btn-outline-info"
          data-toggle="modal"
        >
          <i class="bi bi-pencil-square"></i>
        </button>
        <button
          type="button"
          data-toggle="modal"
          data-target="#exampleModal"
          class="removeKar btn btn-outline-danger"
        >
          <i class="bi bi-trash"></i>
        </button>
      </td>
    </tr>

    <tr>
      <td>K002</td>
      <td>Budi</td>
      <td>Supervisor</td>
      <td>098765432</td>
      <td>budi@gmail.com</td>
      <td>4321</td>
      <td>
        <button
          type="button"
          data-target="#staticBackdrop"
          class="updateBarang btn btn-outline-info"
          data-toggle="modal"
        >
          <i class="bi bi-pencil-square"></i>
        </button>
        <button
          type="button"
          data-toggle="modal"
          data-target="#exampleModal"
          class="removeKar btn btn-outline-danger"
        >
          <i class="bi bi-trash"></i>
        </button>
      </td>
    </tr>
  </tbody>
</table>

<div
  class="modal fade"
  id="staticBackdrop"
  data-backdrop="static"
  tabindex="-1"
  data-keyboard="false"
  aria-labelledby="modalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title" id="modalLabel">Tambah Karyawan</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form>
        <div class="modal-body">
          <form
            action=""
            method="POST"
            enctype="multipart/form-data"
            method="POST"
            id="ModalForm"
          >
            <input
              type="hidden"
              name="_token"
              value="x69ZyrUU0dB2R3MQup1nPSO2BmKoNvtymxYQWPAN"
            />
            <input type="hidden" id="editId" value="" />
            <div class="form-group">
              <div class="row">
                <div class="col">
                  <label for="kodeKar">Kode</label>
                  <input
                    type="text"
                    class="form-control"
                    id="kodeKar"
                    placeholder="S001"
                    name="kodeKar"
                  />
                </div>
                <div class="col">
                  <label for="namaKar">Nama</label>
                  <input
                    type="text"
                    class="form-control"
                    id="namaKar"
                    placeholder="Budi"
                  />
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="jabatanKar">Jabatan</label>
              <input
                type="text"
                class="form-control"
                id="jabatanKar"
                placeholder="Batu"
              />
            </div>

            <div class="form-group">
              <div class="row">
                <div class="col">
                  <label for="telepon">Telepon</label>
                  <input
                    type="text"
                    class="form-control"
                    id="telepon"
                    placeholder="098765432"
                  />
                </div>
                <!-- <div class="col">
                  <label for="telSalesSup">Tel Sales</label>
                  <input
                    type="text"
                    class="form-control"
                    id="telSalesSup"
                    placeholder="13459867"
                  />
                </div> -->
              </div>
            </div>
            <div class="form-group">
              <label for="emailKar">Email</label>
              <input
                type="email"
                class="form-control"
                id="emailKar"
                placeholder="habib123@fake.com"
              />
            </div>
            <div class="form-group">
              <label for="passwordKar">Password</label>
              <input
                type="password"
                class="form-control"
                id="passwordKar"
                placeholder="12345"
              />
            </div>
          </form>
        </div>
        <div class="content"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
          <button
            type="button"
            class="btn btn-danger"
            id="saveKarywan"
            data-dismiss="modal"
          >
            Add
          </button>
          <button
            type="button"
            class="btn updt btn-danger"
            id="saveModalButton"
            data-dismiss="modal"
          >
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    $(function () {
      //Take the data from the TR during the event button
      $("table").on("click", "button.updateBarang", function (ele) {
        // console.log("clik");
        $("#saveModalButton").show();
        $("#saveKarywan").hide();
        $("#kodeKar").prop("disabled", true);
        //the <tr> variable is use to set the parentNode from "ele"
        var tr = ele.target.parentNode.parentNode;

        //I get the value from the cells (td) using the parentNode (var tr)
        var id = $(this).attr("id");
        // console.log(id);
        var currentRow = $(this).closest("tr");
        // console.log(currentRow);

        var col1 = currentRow.find("td:eq(0)").text(); // get current row 1st TD value
        var col2 = currentRow.find("td:eq(1)").text(); // get current row 2nd TD
        var col3 = currentRow.find("td:eq(2)").text();
        var col4 = currentRow.find("td:eq(3)").text();
        var col5 = currentRow.find("td:eq(4)").text();
        var col6 = currentRow.find("td:eq(5)").text();
        // console.log(col1);

        //Prefill the fields with the gathered information
        // $("h5.modal-title").html("Edit Admin Data: " + firstName + "");
        $("#namaKar").val(col2);
        $("#jabatanKar").val(col3);
        $("#telepon").val(col4);
        $("#emailKar").val(col5);
        $("#editId").val(col1);
        $("#passwordKar").val(col6);
        // $("#editLevel").val(level).attr("selected", "selected");

        //If you need to update the form data and change the button link
        $("form#ModalForm").attr(
          "action",
          window.location.href + "/update/" + id
        );
        $("#saveModalButton").attr(
          "href",
          window.location.href + "/update/" + id
        );
      });
    });

    $(function () {
      //Click Event listener waiting for the click from the modal save button
      $("div.modal-footer").on("click", "button#saveModalButton", function () {
        //Get all information from the form field
        var id = $("#editId").attr("value");
        var nama = $("#namaKar").val();
        var jbtn = $("#jabatanKar").val();
        var tel = $("#telepon").val();
        var email = $("#emailKar").val();
        var pass = $("#passwordKar").val();
        var kode = $("#kodeKar").val();

        $("." + kode + " td:nth-child(2)").text(nama);
        $("." + kode + " td:eq(2)").text(jbtn);
        $("." + kode + " td:eq(3)").text(tel);
        $("." + kode + " td:eq(4)").text(email);
        $("." + kode + " td:eq(5)").text(pass);
      });
    });

    function reset() {
      $("#namaKar").val("");
      $("#kodeKar").val("");
      $("#jabatanKar").val("");
      $("#telepon").val("");
      $("#emailKar").val("");
      $("#editId").val("");
      $("#passwordKar").val("");
    }

    $(".btn-add").click(function () {
      reset();
      $("#saveModalButton").hide();
      $("#saveKarywan").show();
      $("#kodeKar").prop("disabled", false);
    });

    $("#saveKarywan").click(function () {
      let panjang = $("#myTable tbody tr").length;
      let kode = $("#kodeKar").val();
      let nama = $("#namaKar").val();
      let jabatan = $("#jabatanKar").val();
      let tel = $("#telepon").val();
      let email = $("#emailKar").val();
      let ket = $("#passwordKar").val();

      $("tbody").append(
        "<tr id=tr" +
          panjang +
          " class='" +
          kode +
          "'><td>" +
          kode +
          "</td><td>" +
          nama +
          "</td><td>" +
          jabatan +
          "</td><td>" +
          tel +
          "</td><td>" +
          email +
          "</td><td>" +
          ket +
          '</td><td> <button type="button" data-target="#staticBackdrop" class="updateBarang btn btn-outline-info" data-toggle="modal" id="id' +
          panjang +
          '" > <i class="bi bi-pencil-square"></i></button> <button type="button" data-toggle="modal" data-target="#exampleModal" id="id' +
          panjang +
          '" class="removeKar btn btn-outline-danger"><i class="bi bi-trash"></i> </button></td></tr>'
      );
    });

    $("tbody").on("click", ".removeKar", function () {
      var id = $(this).attr("id");

      Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, delete it!",
      }).then((result) => {
        // console.log(id);
        if (result.isConfirmed) {
          $(this).closest("tr").remove();
          Swal.fire("Deleted!", "Your data has been deleted.", "success");
        }
      });
    });

    // $("tbody").on("click", ".updateBarang", function () {
    //   var id = $(this).attr("id");
    // });

    // $("#uptdSupplier").click(function () {});
  });
</script>
